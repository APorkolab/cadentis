var u=class{LONG_VOWELS="\xE1\xE9\xED\xF3\u0151\xFA\u0171";SHORT_VOWELS="aeiou\xF6\xFC";VOWELS=this.LONG_VOWELS+this.SHORT_VOWELS;MULTI_LETTER_CONSONANTS=["sz","cs","ty","gy","ny","zs","dz","dzs","ly"];DIPHTHONGS=["ai","au","ei","eu","oi","ou","ui"];SPECIAL_CONSONANT_PAIRS=["kh","ph","th"];STOPS=new Set(["p","t","k","b","d","g"]);LIQUIDS=new Set(["r","l"]);constructor(){addEventListener("message",this.handleMessage.bind(this))}handleMessage(r){let t=performance.now(),{id:s,text:n,type:e,chunkIndex:i,totalChunks:l}=r.data;try{let a;switch(e){case"syllable-count":a=this.analyzeSyllables(n);break;case"verse-analysis":a=this.analyzeVerse(n);break;case"rhyme-analysis":a=this.analyzeRhyme(n);break;default:throw new Error(`Unknown analysis type: ${e}`)}let o=performance.now()-t;postMessage({id:s,result:a,chunkIndex:i,totalChunks:l,processingTime:o})}catch(a){let o=performance.now()-t,c={id:s,result:null,error:a instanceof Error?a.message:"Unknown error",chunkIndex:i,totalChunks:l,processingTime:o};postMessage(c)}}analyzeSyllables(r){let s=r.split(`
`).map(n=>{let{syllableCount:e,moraCount:i}=this.parseText(n);return{syllables:e,moras:i,text:n.trim()}});return{totalSyllables:s.reduce((n,e)=>n+e.syllables,0),totalMoras:s.reduce((n,e)=>n+e.moras,0),lines:s}}analyzeVerse(r){return r.split(`
`).map(s=>s.trim()).filter(s=>s).map(s=>{let{pattern:n,syllableCount:e,moraCount:i}=this.parseText(s),l=this.analyzeStressPattern(s),a=this.detectCaesura(s,n);return{text:s,pattern:n,syllableCount:e,moraCount:i,stressPattern:l,caesuraPosition:a,complexity:this.calculateComplexity(n,l)}})}analyzeRhyme(r){let s=r.split(`
`).map(l=>l.trim()).filter(l=>l).map(l=>this.extractRhymingPart(l)),n=[],e=new Map,i="";for(let l=0;l<s.length;l++){let a=s[l],o=!1;for(let[c,h]of e.entries())if(this.isStrongRhyme(a,c)){n[l]=h,o=!0;break}o||(i=this.getNextRhymePattern(i),n[l]=i,e.set(a,i))}return{pattern:n,analysis:this.analyzeRhymeStructure(n),confidence:this.calculateRhymeConfidence(s,n)}}parseText(r){let t=this.splitIntoSyllables(r),s="",n=0;return t.forEach(e=>{let i=this.extractVowels(e);if(i.length===0)return;let l=this.isLongSyllable(e,i);s+=l?"-":"U",n+=l?2:1}),{pattern:s,syllableCount:t.length,moraCount:n}}splitIntoSyllables(r){let t=r.replace(/[^a-záéíóőúűaeiouöü\s]/gi,"").replace(/\s+/g,"").toLowerCase();if(!t)return[];let s=[],n="";for(let e=0;e<t.length;e++){let i=t[e];if(n+=i,this.isVowel(i)){let l=e+1<t.length?t[e+1]:null;if(!l||this.isVowel(l))s.push(n),n="";else{let a=0,o=e+1;for(;o<t.length&&!this.isVowel(t[o]);){let c=t.slice(o,o+3),h=t.slice(o,o+2);this.MULTI_LETTER_CONSONANTS.includes(c)?(a++,o+=3):this.MULTI_LETTER_CONSONANTS.includes(h)?(a++,o+=2):(a++,o+=1)}if(a===0)s.push(n),n="";else if(o>=t.length){n+=t.slice(e+1),s.push(n),n="";break}else if(a===1)s.push(n),n="";else{let c=1;if(t[e+1]===t[e+2])c=2;else if(t.slice(e+1,e+3)==="ng"&&a>=2)c=2;else{let h=t.slice(e+1,e+3),g=t.slice(e+1,e+4);this.MULTI_LETTER_CONSONANTS.includes(g)?c=3:this.MULTI_LETTER_CONSONANTS.includes(h)&&(c=2)}n+=t.slice(e+1,e+1+c),s.push(n),n="",e+=c}}}}return n&&s.push(n),s.filter(e=>e&&this.extractVowels(e).length>0)}analyzeStressPattern(r){let t=this.splitIntoSyllables(r),s="";return t.forEach((n,e)=>{let i=this.isStressedSyllable(n,e,t);s+=i?"S":"u"}),s}detectCaesura(r,t){let s=r.trim().split(/\s+/);if(s.length<2)return null;let n=0;for(let e=0;e<s.length-1;e++){let i=this.splitIntoSyllables(s[e]).length;if(n+=i,n===Math.floor(t.length/2)||n===Math.floor(t.length*2/3))return n}return null}calculateComplexity(r,t){let s=0,n=new Set(r).size;s+=n*.2;for(let e=0;e<Math.min(r.length,t.length);e++){let i=r[e]==="-"&&t[e]==="S",l=r[e]==="U"&&t[e]==="u";i||l||(s+=.3)}return Math.min(s,5)}analyzeRhymeStructure(r){if(r.length===0)return"No rhyme detected";let t=r.join("");if(r.length===4){if(t==="abab")return"Alternate rhyme (ABAB)";if(t==="abba")return"Enclosed rhyme (ABBA)";if(t==="aabb")return"Coupled rhyme (AABB)";if(t==="aaaa")return"Monorhyme (AAAA)"}let s=new Set(r.filter(e=>e!=="x")).size,n=r.length;return s===1?"Monorhyme":s===n?"No consistent rhyme":s/n<.5?"Complex rhyme scheme":`Custom rhyme scheme (${t})`}calculateRhymeConfidence(r,t){let s=0,n=0;for(let e=0;e<t.length;e++)for(let i=e+1;i<t.length;i++)if(t[e]===t[i]&&t[e]!=="x"){let l=this.calculatePhoneticSimilarity(r[e],r[i]);s+=l,n++}return n>0?s/n:0}calculatePhoneticSimilarity(r,t){if(!r||!t)return 0;let s=r.length,n=t.length,e=Math.max(s,n);if(e===0)return 1;let i=0;for(let l=0;l<Math.min(s,n)&&r[s-1-l]===t[n-1-l];l++)i++;return i/e}isStressedSyllable(r,t,s){return t===0||s.length>4&&t%3===0}extractVowels(r){return r.split("").filter(t=>this.isVowel(t))}isLongSyllable(r,t){if(r==="a")return!0;let s=this.isLongVowel(t[0]),n=this.isLengthenedByCluster(r),e=this.containsDiphthong(r);return s||n||e}isLengthenedByCluster(r){let t=r.search(/[aáeéiíoóöőuúüű]/);if(t===-1)return!1;let s=r.slice(t+1),n=0,e=0;for(;e<s.length;){let i=s.slice(e,e+3).toLowerCase(),l=s.slice(e,e+2).toLowerCase();if(this.SPECIAL_CONSONANT_PAIRS.includes(l)){e+=2;continue}if(this.MULTI_LETTER_CONSONANTS.includes(i)){n++,e+=3;continue}if(this.MULTI_LETTER_CONSONANTS.includes(l)){n++,e+=2;continue}if(e+1<s.length){let a=s[e].toLowerCase(),o=s[e+1].toLowerCase();if(this.STOPS.has(a)&&this.LIQUIDS.has(o)){n+=1,e+=2;continue}}this.isConsonant(s[e])&&n++,e++}return n>=2}containsDiphthong(r){return this.DIPHTHONGS.some(t=>r.includes(t))}isLongVowel(r){return this.LONG_VOWELS.includes(r)}isVowel(r){return this.VOWELS.includes(r)}isConsonant(r){return!this.isVowel(r)&&/[a-zA-Z]/.test(r)}extractRhymingPart(r){let t=r.toLowerCase().replace(/[!?.(),{}'\":;«»-]/g,""),s=Array.from(t).map((e,i)=>this.isVowel(e)?i:-1).filter(e=>e!==-1);if(s.length===0)return t;let n=s[s.length-1];return t.slice(n)}isStrongRhyme(r,t){if(!r||!t)return!1;let s=Array.from(r).filter(o=>this.isVowel(o)),n=Array.from(t).filter(o=>this.isVowel(o));if(s.join("")!==n.join(""))return!1;let e=r.lastIndexOf(s[s.length-1]),i=t.lastIndexOf(n[n.length-1]),l=r.slice(e+1),a=t.slice(i+1);return l===a}getNextRhymePattern(r){if(!r)return"a";let t="abcdefghijklmnopqrstuvwxyz".split(""),s=t.indexOf(r);return s<t.length-1?t[s+1]:"aa"}};new u;
